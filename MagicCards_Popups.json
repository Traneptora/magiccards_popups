{"id":"MagicCards_Popups","title":"MagicCards Popups","css":"","script":"//* TITLE MagicCards Popups **//\n//* VERSION 0.1.0 **//\n//* DESCRIPTION    Creates visual popups for links to cards on magiccards.info **//\n//* DEVELOPER thebombzen **//\n//* FRAME false **//\n//* BETA true **//\n\nXKit.extensions.MagicCards_Popups = new Object({\n\n    addPopup: function(atag, newHref){\n        var img = document.createElement(\"img\");\n        img.src = newHref;\n        img.style.padding = \"0px\";\n        img.style.border =  \"0px\";\n        img.style.width = \"312px\";\n        img.style.height = \"445px\";\n        img.style.position = \"fixed\";\n        img.style.visibility = \"hidden\";\n        img.style.zIndex = \"300\";\n        $(atag).addClass(\"magiccards_popups-tooltip\");\n        atag.appendChild(img);\n        $(atag).hover(function(){\n            $(this.lastElementChild).css(\"visibility\", \"visible\");\n        }, function(){\n            $(this.lastElementChild).css(\"visibility\", \"hidden\");\n        })\n        $(atag).on(\"mousemove.magiccards_popups\", function(event){\n            var x = event.clientX, y = event.clientY;\n            if (y > window.innerHeight / 2){\n                y -= 485;\n            }\n            this.lastElementChild.style.top = (y + 20) + 'px';\n            this.lastElementChild.style.left = (x + 20) + 'px';\n        });\n    },\n\n    addPopupsIfNecessary: function (){\n        if (XKit.interface.is_tumblr_page() !== true){\n            return;\n        }\n        $(\"a\").each(function(){\n            var atag = this;\n            if ($(atag).hasClass(\"magiccards_popups-tooltip\")){\n                return;\n            }\n            if (atag.href){\n                if (atag.href.match(/^.*?\\/\\/magiccards.info\\/.*?\\/.*?\\/.*?\\.html$/)){\n                    var theMatch = /^.*?\\/\\/magiccards.info\\/(.*?)\\/(.*?)\\/(.*?)\\.html$/.exec(atag.href);\n                    var newHref = \"http://magiccards.info/scans/\" + theMatch[2] + \"/\" + theMatch[1] + \"/\" + theMatch[3] + \".jpg\";\n                    XKit.extensions.MagicCards_Popups.addPopup(atag, newHref);\n                } else if (atag.href.match(/^http:\\/\\/t.umblr.com\\/redirect\\?z=http%3A%2F%2Fmagiccards\\.info%2F.*?%2F.*?%2F.*?\\.html(&.*)*$/)){\n                    var replaced = /^http:\\/\\/t.umblr.com\\/redirect\\?z=(http%3A%2F%2Fmagiccards\\.info%2F.*?%2F.*?%2F.*?\\.html)(&.*)*$/.exec(atag.href);\n                    var theMatch = /^.*?\\/\\/magiccards.info\\/(.*?)\\/(.*?)\\/(.*?)\\.html$/.exec(decodeURIComponent(replaced[1]));\n                    var newHref = \"http://magiccards.info/scans/\" + theMatch[2] + \"/\" + theMatch[1] + \"/\" + theMatch[3] + \".jpg\";\n                    XKit.extensions.MagicCards_Popups.addPopup(atag, newHref);\n                }\n            }\n        });\n    },\n\n    removePopup: function(atag){\n        atag.removeChild(atag.lastElementChild);\n        $(atag).off(\"mousemove.magiccards_popups\");\n        $(atag).removeClass(\"magiccards_popups-tooltip\");\n    },\n\n    removePopups: function(){\n        $(\".magiccards_popups-tooltip\").each(function () {\n             XKit.extensions.MagicCards_Popups.removePopup(this);\n        });\n    },\n\n    running: false,\n\n    run: function() {\n        this.running = true;\n        XKit.extensions.MagicCards_Popups.addPopupsIfNecessary();\n        XKit.post_listener.add(\"MagicCards_Popups\", XKit.extensions.MagicCards_Popups.addPopupsIfNecessary);\n    },\n\n    destroy: function() {\n        this.running = false;\n        XKit.extensions.MagicCards_Popups.removePopups();\n        XKit.post_listener.remove(\"MagicCards_Popups\");\n    }\n\n});\n\n","icon":"https://i.imgur.com/N0mn2b7.png","description":"   Creates visual popups for links to cards on magiccards.info","developer":"thebombzen","version":"0.1.0","errors":false,"beta":true,"frame":false,"details":""}

